{% set _theme = get_theme_config() %}
{% set _default_mode = _theme.default_mode or 'light' %}
{% set _default_avatar = '/themes/hoshizora/static/images/avatar.svg' %}
<!DOCTYPE html>
<html lang="zh-CN" data-theme="{{ _default_mode }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{{ page_title or (site_title or 'Noteblog') }}{% endblock %}</title>
    <meta name="description" content="{% block description %}{{ site_description or page_description or '' }}{% endblock %}">
    <meta name="keywords" content="{% block keywords %}{{ site_keywords or '' }}{% endblock %}">

    {% if _theme.site_favicon %}
    <link rel="icon" type="image/png" href="{{ _theme.site_favicon }}">
    {% endif %}

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap">
    <link rel="stylesheet" href="/themes/hoshizora/static/css/hoshizora.css">

    <style>
        :root {
            --hoshi-primary: {{ _theme.primary_color or '#8d6bff' }};
            --hoshi-secondary: {{ _theme.secondary_color or '#ff8bd5' }};
            --hoshi-accent: {{ _theme.accent_color or '#6ff4ff' }};
        }
        body.hoshizora-body {
            background: linear-gradient({{ _theme.gradient_direction or '120deg' }}, rgba(17, 12, 32, 0.95), rgba(9, 9, 17, 0.98));
        }
        {% if _theme.background_texture == 'grid' %}
        .hoshi-bg::before,
        .hoshi-bg::after {
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 30h60M30 0v60' stroke='%23ffffff' stroke-opacity='0.08' /%3E%3C/svg%3E");
        }
        {% elif _theme.background_texture == 'waves' %}
        .hoshi-bg::before,
        .hoshi-bg::after {
            background-image: url("data:image/svg+xml,%3Csvg width='320' height='180' viewBox='0 0 320 180' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 90 C60 120 120 60 180 90 C240 120 300 60 360 90' stroke='%23ffffff' stroke-opacity='0.07' fill='none' stroke-width='8'/%3E%3C/svg%3E");
        }
        {% elif _theme.background_texture == 'none' %}
        .hoshi-bg::before,
        .hoshi-bg::after {
            background: none;
        }
        {% endif %}
    </style>

    {% block head %}{% endblock %}

    {% if plugin_hooks and plugin_hooks.head_assets %}
        {% for asset in plugin_hooks.head_assets %}
            {{ asset|safe }}
        {% endfor %}
    {% endif %}
</head>
<body class="hoshizora-body" data-default-mode="{{ _default_mode }}" data-parallax="{{ 'true' if _theme.enable_parallax != false else 'false' }}" data-particles="{{ 'true' if _theme.enable_particle_field != false else 'false' }}">
    {% if _theme.enable_scroll_indicator != false %}
    <div class="hoshi-reading-progress" data-hoshi-progress>
        <span></span>
    </div>
    {% endif %}
    <div class="hoshi-bg"></div>
    {% if _theme.enable_particle_field != false %}
    <canvas class="hoshi-particles" data-hoshi-particles></canvas>
    {% endif %}
    <div class="hoshi-noise"></div>

    <div class="hoshi-app">
        <header class="hoshi-header">
            <div class="hoshi-header-inner">
                <div class="hoshi-brand">
                    <a href="/" class="hoshi-logo">
                        {% if _theme.site_logo %}
                            <img src="{{ _theme.site_logo }}" alt="{{ site_title or 'Noteblog' }}">
                        {% endif %}
                        <span>{{ site_title or 'Noteblog' }}</span>
                    </a>
                    <span class="hoshi-badge">{{ _theme.hero_highlight_text or '#GalacticLive' }}</span>
                </div>
                <button class="hoshi-icon-btn hoshi-mobile-toggle" type="button" aria-label="åˆ‡æ¢å¯¼èˆª" data-hoshi-nav-toggle>â˜°</button>
                <nav class="hoshi-nav" data-hoshi-nav>
                    <a href="/" class="{% if request.path == '/' %}active{% endif %}">é¦–é¡µ</a>
                    <a href="/archives" class="{% if request.path.startswith('/archives') %}active{% endif %}">å½’æ¡£</a>
                    <a href="/categories" class="{% if request.path.startswith('/categories') %}active{% endif %}">åˆ†ç±»</a>
                    <a href="/tags" class="{% if request.path.startswith('/tags') %}active{% endif %}">æ ‡ç­¾</a>
                    <a href="/search" class="{% if request.path.startswith('/search') %}active{% endif %}">æœç´¢</a>
                    {% if plugin_hooks and plugin_hooks.nav %}
                        {% for hook in plugin_hooks.nav %}
                            {{ hook|safe }}
                        {% endfor %}
                    {% endif %}
                </nav>
                <div class="hoshi-actions">
                    <button class="hoshi-icon-btn" type="button" title="æœç´¢" data-hoshi-search>
                        ğŸ”
                    </button>
                    {% if _theme.enable_dark_mode_toggle != false %}
                    <button class="hoshi-icon-btn" type="button" title="åˆ‡æ¢ä¸»é¢˜" data-hoshi-theme>
                        â˜¯
                    </button>
                    {% endif %}
                    {% if current_user.is_authenticated %}
                        <div class="hoshi-user-chip">
                            <span>{{ (current_user.display_name or current_user.username)[:1].upper() }}</span>
                            <div class="hoshi-user-menu">
                                <a href="/auth/profile">ä¸ªäººèµ„æ–™</a>
                                {% if current_user.is_admin %}
                                <a href="/admin">ç®¡ç†åå°</a>
                                {% endif %}
                                <a href="/auth/logout">é€€å‡ºç™»å½•</a>
                            </div>
                        </div>
                    {% else %}
                        <button class="hoshi-ghost-btn" type="button" data-hoshi-auth-toggle="login">ç™»å…¥å†’é™©</button>
                    {% endif %}
                </div>
            </div>
        </header>

        {% block hero %}
        <section class="hoshi-hero">
            <div class="hoshi-hero-left">
                <span class="hoshi-hero-tag">{{ _theme.hero_highlight_text or '#GalacticLive' }}</span>
                <h1 class="hoshi-hero-title">{{ site_title or 'Noteblog' }}</h1>
                <p class="hoshi-hero-desc">{{ _theme.hero_tagline or 'å°‘å¥³ä¸æ˜Ÿå°˜ï¼Œå…±åŒç¼–ç»‡çš„å†’é™©æ—¥å¿—' }}</p>
                <div class="hoshi-hero-actions">
                    <a class="hoshi-pill-btn primary" href="{{ _theme.hero_cta_link or '/archives' }}">{{ _theme.hero_cta_text or 'å¼€å§‹å·¡èˆª' }}</a>
                    <a class="hoshi-pill-btn secondary" href="/hoshizora/gallery">åº”æ´ç›¸å†Œ</a>
                </div>
            </div>
            <div class="hoshi-hero-right">
                <div class="hoshi-chibi-card">
                    <div class="avatar">â˜†</div>
                    <h4>{{ _theme.hero_character_name or 'æ˜Ÿé‡æ¾ª' }}</h4>
                    <p>â€œç•™ä¸‹ä¸€æšå¿ƒåŠ¨ï¼Œä¸–ç•Œå°±ä¼šäº®èµ·æ¥ã€‚â€</p>
                    <div class="hoshi-chibi-tags">
                        <span>Vocal</span>
                        <span>Drift</span>
                        <span>Magic</span>
                    </div>
                </div>
            </div>
        </section>
        {% endblock %}

        <main class="hoshi-main">
            <div class="hoshi-container">
                {% with flashes = get_flashed_messages(with_categories=true) %}
                    {% if flashes %}
                    <div class="hoshi-flashes">
                        {% for category, message in flashes %}
                        <div class="hoshi-flash hoshi-flash-{{ category }}">{{ message }}</div>
                        {% endfor %}
                    </div>
                    {% endif %}
                {% endwith %}

                <div class="hoshi-layout {% if _theme.show_sidebar == false or _admin_page %}no-sidebar{% endif %}">
                    <section class="hoshi-content">
                        {% if plugin_hooks and plugin_hooks.content_top %}
                            {% for block in plugin_hooks.content_top %}
                                {{ block|safe }}
                            {% endfor %}
                        {% endif %}

                        {% block content %}{% endblock %}

                        {% if plugin_hooks and plugin_hooks.content_bottom %}
                            {% for block in plugin_hooks.content_bottom %}
                                {{ block|safe }}
                            {% endfor %}
                        {% endif %}
                    </section>

                    {% if _theme.show_sidebar != false and not _admin_page %}
                    <aside class="hoshi-sidebar">
                        {% block sidebar %}
                        <div class="hoshi-widget hoshi-profile-card">
                            <img src="{{ _theme.site_logo or _default_avatar }}" alt="{{ site_title }}">
                            <h3>{{ site_title or 'Noteblog' }}</h3>
                            <p>{{ site_description or 'è®°å½•æˆ‘çš„æ˜Ÿå°˜æ—¥è®°ã€‚' }}</p>
                            <div class="hoshi-divider"></div>
                            <div class="hoshi-tag-row">
                                <span class="hoshi-meta-pill">Online</span>
                                <span class="hoshi-meta-pill">èŒåŠ›</span>
                            </div>
                        </div>
                        <div class="hoshi-widget">
                            <h4 class="hoshi-widget-title">æœ€æ–°å‘è¡¨</h4>
                            <ul class="hoshi-list">
                                {% for post in (recent_posts|default([]))[:5] %}
                                <li><a href="/post/{{ post.slug }}"><span>{{ post.title }}</span><small>â†’</small></a></li>
                                {% endfor %}
                            </ul>
                        </div>
                        <div class="hoshi-widget">
                            <h4 class="hoshi-widget-title">åˆ†ç±»</h4>
                            <div class="hoshi-tag-cloud">
                                {% for category in categories|default([]) %}
                                <a class="hoshi-tag-pill" href="/category/{{ category.slug }}">{{ category.name }} Â· {{ category.post_count or 0 }}</a>
                                {% endfor %}
                            </div>
                        </div>
                        <div class="hoshi-widget">
                            <h4 class="hoshi-widget-title">æ ‡ç­¾</h4>
                            <div class="hoshi-tag-cloud">
                                {% for tag in tags|default([]) %}
                                <a class="hoshi-tag-pill" href="/tag/{{ tag.slug }}">#{{ tag.name }}</a>
                                {% endfor %}
                            </div>
                        </div>
                        {% if plugin_hooks and plugin_hooks.sidebar_bottom %}
                            {% for block in plugin_hooks.sidebar_bottom %}
                                {{ block|safe }}
                            {% endfor %}
                        {% endif %}
                        {% endblock %}
                    </aside>
                    {% endif %}
                </div>
            </div>
        </main>

        <footer class="hoshi-footer">
            <p>{{ _theme.footer_text or 'Â© 2025 æ˜Ÿç©ºå¹»å¥ä¸»é¢˜ - è®°å½•æ¯ä¸€æ¬¡å¿ƒåŠ¨ã€‚' }}</p>
            <p>Powered by <a href="https://github.com/streetartist/noteblog" target="_blank" rel="noopener">Noteblog</a> Â· Theme Hoshizora</p>
            {% if plugin_hooks and plugin_hooks.footer %}
                {% for block in plugin_hooks.footer %}
                    {{ block|safe }}
                {% endfor %}
            {% endif %}
        </footer>
    </div>

    <button class="hoshi-backtotop" type="button" aria-label="å›åˆ°é¡¶éƒ¨" data-hoshi-backtotop>â†Ÿ</button>

    <div class="hoshi-search-overlay" data-hoshi-search-overlay>
        <div class="hoshi-search-box">
            <form action="/search" method="GET">
                <input type="text" name="q" placeholder="è¾“å…¥å…³é”®è¯..." autocomplete="off">
                <button type="submit">æœç´¢</button>
                <button type="button" class="hoshi-icon-btn" aria-label="å…³é—­" data-hoshi-search-close>Ã—</button>
            </form>
        </div>
    </div>

    {% include 'auth/login.html' %}

    <script src="/themes/hoshizora/static/js/hoshizora.js" defer></script>

    {% if plugin_hooks and plugin_hooks.body_end %}
        {% for block in plugin_hooks.body_end %}
            {{ block|safe }}
        {% endfor %}
    {% endif %}

    {% if _theme.analytics_code %}
        {{ _theme.analytics_code|safe }}
    {% endif %}
</body>
</html>
